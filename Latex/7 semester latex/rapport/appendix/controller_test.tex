\section{Controller test}
\label{app:controller_test}
\subsection*{Purpose:}
The purpose of this journal is to test how the genset reacts with the designed controller applied. Furthermore the scaling factor is tuned as to investigate if there is a more ideal value for the controller. 

\subsection*{Equipment}

\begin{itemize}
	\item Genset
		\begin{itemize}
			\item \textbf{Engine:} Deutz; BF 4M 2012
			\item \textbf{Alternator:} Leroy Somer; LSA 42.3 L9 C6/4
			\item \textbf{Governor:} Deutz; EMRII("EMR2")
			\item \textbf{AVR:} DEIF; DVC310 
		\end{itemize}
		\item Inverter
		% \begin{itemize}
		% 	\item \textbf{SMA:} STP25000TL-30
		% 	\item \textbf{DC sources:} 2 x Regatron: TopCon DC Power supply \newline (TC.P.10.1000.400.NS+1.TFE.HMI)
		% \end{itemize}
		\item dSPACE unit (AAU: 61508)
		\item Hioki (datasheets are found under the path \path{CD:Hioki/}).
		\begin{itemize}
			\item HIOKI MEMORY HiCORDER 8861
			\begin{itemize}
				\item 5 x 8957 (HIGH-RESOLUTION UNIT)
			\end{itemize}
			\item \textbf{Differential probes:} 3 x Metrix MX9030-Z,
			\item \textbf{Current sensors:} 3 x HIOKI 9667 FLEXIBLE CLAMP ON SENSOR
		\end{itemize}
		\item Interface (datasheet is found under the path \path{CD:dSPACE/interface}).
\end{itemize}	


\subsection*{Procedure:}

\begin{itemize}
	%\item To setup this test either Jesper Viese Knudsen or Kjeld K. Madsen needs to attend.  
	\item The interface needs to be setup with the genset. CANbus, analog readings and frequency measurement.  
	\item The Hioki scope connected to the genset.
	\item Connect computer.
	\item Load CA7\_full\_system into simulink on the computer \path{CD:simulink/CA7/CA7\_full\_system}.
	\item Load build\_script into matlab \path{CD:simulink/CA7/build\_script}. 
	\item Compile the build\_script.
	\item Open ControlDesk.
	\item Open project CA7 inside ControlDesk.
	\item Press 'Go Online' and 'start measuring' inside ControlDesk. 
	\item Set the needed measuring time for the Hioki scope.
	\item Set the 'gain8' through ControlDesk to 0.1, 0.15, 0.2, 0.25 or 0.35.  
	\item Start Genset.
	\item The following procedure is to be done at load steps of 10-20, 20-30, 30-40, 40-50, 10-30, 30-50 and 10-50.
	\item Redo the test with a different gain.
	\item Save the data from the Hioki scope on a USB stick or transfer the data through a LAN cable to a PC.  



\end{itemize}


\subsection*{Setup:}
\begin{figure}[H]
\centering
\includegraphics[width=0.7\textwidth]{rapport/billeder/Frequency_step_setup}
\caption{Setup for measurement at DEIF.}
\label{fig:Frequency_step_setup}
\end{figure} 


\subsection*{Measurement data:}


% \begin{figure}[H]
% \centering
% \input{rapport/Tikz/test11-14power1.tex}
% \caption{Figure showing power steps with different scaling factors.}
% \label{fig:test1-6load}
% \end{figure}

\begin{figure}[H]
\centering
\input{rapport/Tikz/test11-14freq1.tex}
\caption{Figure showing frequency disturbance with different scaling factors.}
\label{fig:test11-14freq}
\end{figure}

\begin{figure}[H]
\centering
\input{rapport/Tikz/test11-14volt1.tex}
\caption{Figure showing Voltage disturbance with different scaling factors.}
\label{fig:test11-14volt}
\end{figure}

\begin{figure}[H]
\centering
\input{rapport/Tikz/test15-instablecontroller.tex}
\caption{Plot showing the controller turned on at 12 seconds with scaling factor set to 0.3, at approximately 22 seconds  scaling factor is changed to 0.35.}
\label{fig:test15-instablecontroller}
\end{figure}

%------------------------------------------------------------------------
\subsection{Steady state measurements}
\subsubsection{Frequency}

\begin{figure}[H]
\centering
\input{rapport/Tikz/test11-14steadyfrequency10kw.tex}
\caption{Steady state at 10 kW load, with various scaling factors.}
\label{fig:test11-14steadyfrequency10kw}
\end{figure}

\begin{figure}[H]
\centering
\input{rapport/Tikz/test11-14steadyfrequency20kw.tex}
\caption{Steady state at 20 kW load, with various scaling factors.}
\label{fig:test11-14steadyfrequency20kw}
\end{figure}

\begin{figure}[H]
\centering
\input{rapport/Tikz/test11-14steadyfrequency30kw.tex}
\caption{Steady state at 30 kW load, with various scaling factors.}
\label{fig:test11-14steadyfrequency30kw}
\end{figure}

\begin{figure}[H]
\centering
\input{rapport/Tikz/test11-14steadyfrequency40kw.tex}
\caption{Steady state at 40 kW load, with various scaling factors.}
\label{fig:test11-14steadyfrequency40kw}
\end{figure}

\begin{figure}[H]
\centering
\input{rapport/Tikz/test11-14steadyfrequency50kw.tex}
\caption{Steady state at 50 kW load, with various scaling factors.}
\label{fig:test11-14steadyfrequency50kw}
\end{figure}

\subsubsection{Power}
\begin{figure}[H]
\centering
\input{rapport/Tikz/test11-14steadypower10kw.tex}
\caption{Steady state at 10 kW load, with various scaling factors.}
\label{fig:test11-14steadypower10kw}
\end{figure}

\begin{figure}[H]
\centering
\input{rapport/Tikz/test11-14steadypower20kw.tex}
\caption{Steady state at 20 kW load, with various scaling factors.}
\label{fig:test11-14steadypower20kw}
\end{figure}

\begin{figure}[H]
\centering
\input{rapport/Tikz/test11-14steadypower30kw.tex}
\caption{Steady state at 30 kW load, with various scaling factors.}
\label{fig:test11-14steadypower30kw}
\end{figure}

\begin{figure}[H]
\centering
\input{rapport/Tikz/test11-14steadypower40kw.tex}
\caption{Steady state at 40 kW load, with various scaling factors.}
\label{fig:test11-14steadypower40kw}
\end{figure}

\begin{figure}[H]
\centering
\input{rapport/Tikz/test11-14steadypower50kw.tex}
\caption{Steady state at 50 kW load, with various scaling factors.}
\label{fig:test11-14steadypower50kw}
\end{figure}

\subsubsection{Voltage}

\begin{figure}[H]
\centering
\input{rapport/Tikz/test11-14steadyvolt10kw.tex}
\caption{Steady state at 10 kW load, with various scaling factors.}
\label{fig:test11-14steadyvolt10kw}
\end{figure}

\begin{figure}[H]
\centering
\input{rapport/Tikz/test11-14steadyvolt20kw.tex}
\caption{Steady state at 20 kW load, with various scaling factors.}
\label{fig:test11-14steadyvolt20kw}
\end{figure}

\begin{figure}[H]
\centering
\input{rapport/Tikz/test11-14steadyvolt30kw.tex}
\caption{Steady state at 30 kW load, with various scaling factors.}
\label{fig:test11-14steadyvolt30kw}
\end{figure}

\begin{figure}[H]
\centering
\input{rapport/Tikz/test11-14steadyvolt40kw.tex}
\caption{Steady state at 40 kW load, with various scaling factors.}
\label{fig:test11-14steadyvolt40kw}
\end{figure}

\begin{figure}[H]
\centering
\input{rapport/Tikz/test11-14steadyvolt50kw.tex}
\caption{Steady state at 50 kW load, with various scaling factors.}
\label{fig:test11-14steadyvolt50kw}
\end{figure}

\subsection{Step measurements}
\subsubsection{Frequency}
%----------------------------------------------------
\begin{figure}[H]
\centering
\input{rapport/Tikz/test11-14-10to20kwstepfreq.tex}
\caption{Step from 10 to 20 kW load, with various scaling factors. }
\label{fig:test11-14-10to20kwstepfreq}
\end{figure}

\begin{figure}[H]
\centering
\input{rapport/Tikz/test11-14-10to30kwstepfreq.tex}
\caption{Step from 10 to 30 kW load, with various scaling factors.}
\label{fig:test11-14-10to30kwstepfreq}
\end{figure}

\begin{figure}[H]
\centering
\input{rapport/Tikz/test11-14-10to50kwstepfreq.tex}
\caption{Step from 10 to 50 kW load, with various scaling factors.}
\label{fig:test11-14-10to50kwstepfreq}
\end{figure}

\begin{figure}[H]
\centering
\input{rapport/Tikz/test11-14-30to50kwstepfreq.tex}
\caption{Step from 30 to 50 kW load, with various scaling factors.}
\label{fig:test11-14-30to50kwstepfreq}
\end{figure}

\begin{figure}[H]
\centering
\input{rapport/Tikz/test11-14-20to30kwstepfreq.tex}
\caption{Step from 20 to 30 kW load, with various scaling factors.}
\label{fig:test11-14-20to30kwstepfreq}
\end{figure}

\begin{figure}[H]
\centering
\input{rapport/Tikz/test11-14-30to40kwstepfreq.tex}
\caption{Step from 30 to 40 kW load, with various scaling factors.}
\label{fig:test11-14-30to40kwstepfreq}
\end{figure}

\begin{figure}[H]
\centering
\input{rapport/Tikz/test11-14-40to50kwstepfreq.tex}
\caption{Step from 40 to 50 kW load, with various scaling factors.}
\label{fig:test11-14-40to50kwstepfreq}
\end{figure}

\begin{figure}[H]
\centering
\input{rapport/Tikz/test11-14-50to10kwstepfreq.tex}
\caption{Step from 50 to 10 kW load, with various scaling factors.}
\label{fig:test11-14-50to10kwstepfreq}
\end{figure}

\subsubsection{Power}
%---------------------------------------------------

\begin{figure}[H]
\centering
\input{rapport/Tikz/test11-14-10to20kwsteppower.tex}
\caption{Step from 10 to 20 kW load, with various scaling factors.}
\label{fig:test11-14-10to20kwsteppower}
\end{figure}

\begin{figure}[H]
\centering
\input{rapport/Tikz/test11-14-10to30kwsteppower.tex}
\caption{Step from 10 to 30 kW load, with various scaling factors.}
\label{fig:test11-14-10to30kwsteppower}
\end{figure}

\begin{figure}[H]
\centering
\input{rapport/Tikz/test11-14-10to50kwsteppower.tex}
\caption{Step from 10 to 50 kW load, with various scaling factors.}
\label{fig:test11-14-10to50kwsteppower}
\end{figure}

\begin{figure}[H]
\centering
\input{rapport/Tikz/test11-14-30to50kwsteppower.tex}
\caption{Step from 30 to 50 kW load, with various scaling factors.}
\label{fig:test11-14-30to50kwsteppower}
\end{figure}

\begin{figure}[H]
\centering
\input{rapport/Tikz/test11-14-20to30kwsteppower.tex}
\caption{Step from 20 to 30 kW load, with various scaling factors.}
\label{fig:test11-14-20to30kwsteppower}
\end{figure}

\begin{figure}[H]
\centering
\input{rapport/Tikz/test11-14-30to40kwsteppower.tex}
\caption{Step from 30 to 40 kW load, with various scaling factors.}
\label{fig:test11-14-30to40kwsteppower}
\end{figure}

\begin{figure}[H]
\centering
\input{rapport/Tikz/test11-14-40to50kwsteppower.tex}
\caption{Step from 40 to 50 kW load, with various scaling factors.}
\label{fig:test11-14-40to50kwsteppower}
\end{figure}

\begin{figure}[H]
\centering
\input{rapport/Tikz/test11-14-50to10kwsteppower.tex}
\caption{Step from 50 to 10 kW load, with various scaling factors.}
\label{fig:test11-14-50to10kwsteppower}
\end{figure}

\subsubsection{Voltage}
%---------------------------------------------------

\begin{figure}[H]
\centering
\input{rapport/Tikz/test11-14-10to20kwstepvolt.tex}
\caption{Step from 10 to 20 kW load, with various scaling factors.}
\label{fig:test11-14-10to20kwstepvolt}
\end{figure}

\begin{figure}[H]
\centering
\input{rapport/Tikz/test11-14-10to30kwstepvolt.tex}
\caption{Step from 10 to 30 kW load, with various scaling factors.}
\label{fig:test11-14-10to30kwstepvolt}
\end{figure}

\begin{figure}[H]
\centering
\input{rapport/Tikz/test11-14-10to50kwstepvolt.tex}
\caption{Step from 10 to 50 kW load, with various scaling factors.}
\label{fig:test11-14-10to50kwstepvolt}
\end{figure}

\begin{figure}[H]
\centering
\input{rapport/Tikz/test11-14-30to50kwstepvolt.tex}
\caption{Step from 30 to 50 kW load, with various scaling factors.}
\label{fig:test11-14-30to50kwstepvolt}
\end{figure}

\begin{figure}[H]
\centering
\input{rapport/Tikz/test11-14-20to30kwstepvolt.tex}
\caption{Step from 20 to 30 kW load, with various scaling factors.}
\label{fig:test11-14-20to30kwstepvolt}
\end{figure}

\begin{figure}[H]
\centering
\input{rapport/Tikz/test11-14-30to40kwstepvolt.tex}
\caption{Step from 30 to 40 kW load, with various scaling factors.}
\label{fig:test11-14-30to40kwstepvolt}
\end{figure}

\begin{figure}[H]
\centering
\input{rapport/Tikz/test11-14-40to50kwstepvolt.tex}
\caption{Step from 40 to 50 kW load, with various scaling factors.}
\label{fig:test11-14-40to50kwstepvolt}
\end{figure}

\begin{figure}[H]
\centering
\input{rapport/Tikz/test11-14-50to10kwstepvolt.tex}
\caption{Step from 50 to 10 kW load, with various scaling factors.}
\label{fig:test11-14-50to10kwstepvolt}
\end{figure}


\subsection*{Results:}

When the scaling factor ranges from 0.1 to 0.25 the genset are stable, but when the scaling factor is increased to 0.3 after 12 seconds, the genset start to fluctuate in frequency. When the gain is increased further to 0.35 at 20 seconds the genset starts to fluctuate more rapid as shown on \figref{fig:test15-instablecontroller}. Furthermore the genset started shaking due to the controller reacting to intense on the input therefore gains higher or equal to 0.3 are disregarded. The scaling factor giving the most steady output on frequency, Voltage and power is 0.1, which is shown on the lower overshoot in frequency which is clearly shown on \figref{fig:test11-14-10to20kwstepfreq}. Visible influence due to the nature of the second order model is more apperent at higher values of the scaling factor as shown on \figref{fig:test11-14-20to30kwstepvolt}. At 10 kW load the lower scaling factor shows improved steady state stability over higher values, which is shown on \figref{fig:test11-14steadyfrequency10kw} and \figref{fig:test11-14steadyvolt10kw}.

\subsection*{Conclusion}
It shows clearly that the designed controller has a larger impact in lowering disturbance at lower scaling factors but only at certain load levels. The higher scaling factors shows the dynamics of the second order model derived for the use of designing the controller, giving a more fluctuating output on the genset. The scaling factor of 0.1 should be chosen af the prefered value for the designed controller.    