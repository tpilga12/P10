\subsection{Stability \& Precision} \label{subse:stability_and_precision}

Stability is an important parameter to consider when trying to obtain a solution for nonlinear equations. 
An advantage of the Preissmann scheme is that if the parameter $\theta$ is chosen $0.5 \leq \theta \leq 1$, then stability is unconditionally guaranteed \cite{cunge1980practical}. But guaranteed stability does not necessarily mean precision in the obtained solution. An accurate solution can be found when $\theta$ is set to 0,5 and appropriate values of $\Delta t$ and $\Delta x$ are chosen. For some explicit schemes, utilized for solving the Saint-Venant equations, the Courant number is often used as a stability criterion. It can also be utilized as an indication of precision of the Preissmann scheme. The Courant number can be obtained by the following equation \cite{cunge1980practical,szymkiewicz2010numerical}.

\begin{equation} \label{eq:courant_number_equation}
	C_r =  \frac{\sqrt{g \cdot \overline{\text{H}}} \cdot \Delta t}{\Delta x}
\end{equation}

Where g is the gravitational constant, $\overline{\text{H}}$ is average flow height in the pipe, $\Delta t$ is time step and $\Delta x$ is distance step. A test clarifying the effect of various Courant numbers is performed on a pipe with the specifications shown in table \ref{tab:pipe_stability_test}.

\begin{table}[H]
\centering
\begin{tabular}{|l|c|}  \hline
Length  	& 500 m \\ \hline
Sections 	& 25  	\\ \hline
$\Delta x$	& 20 m  \\ \hline
Diameter	& 1.2 m \\ \hline
Ib			& 3 \textperthousand \\ \hline
\end{tabular}
\caption{Pipe specifications}
\label{tab:pipe_stability_test}
\end{table}

In the above pipe a step in inflow is given from 0,35 $\text{m}^\text{3}/ \text{s}$ to 0,7 $\text{m}^\text{3}/ \text{s}$ and for various Courant numbers, $\Delta t$ is found by equation \ref{eq:courant_number_equation}. The results can be seen in figure \ref{fig:stability_test_theta_0_5}. 

\begin{figure}[H]
 \centering
 \input{report/simulation/tikz/stability_test_theta_0_5}
\caption{Step in inflow given from 0,35 $\text{m}^\text{3}/ \text{s}$ to 0.7 $\text{m}^\text{3}/ \text{s}$ at first iteration in pipe listed in table \ref{tab:pipe_stability_test}. Plot for all tests is made at approximately t = 100 seconds.}
\label{fig:stability_test_theta_0_5}
\end{figure}

It is clear from the results shown in figure \ref{fig:stability_test_theta_0_5} that considerations when choosing $\Delta t$ and $\Delta x$ should be made, as it can have an undesirable effect on the results. Another anomaly discovered is that the Courant number has to be slightly more than one to obtain a perfect calculation, i.e. no oscillation occurring before or after the wave. An attempt to mitigate the error by minimizing the threshold of the approximation by Newton's method from $10^{-6}$ to $10^{-9}$ yielded no change in the obtained result. Further investigations were not made on the subject.
The parameter $\theta$ should not be left out of the equation, as higher values have a dampening effect on the wave. In figure \ref{fig:stability_theta_test_05_065_1} various values of $\theta$ is tested  with $\Delta t$ set to 9,754.    

\begin{figure}[H]
 \centering
 \input{report/simulation/tikz/stability_theta_test_05_065_1}
\caption{Step in inflow given from 0,35 $\text{m}^\text{3}/ \text{s}$ to 0.7 $\text{m}^\text{3}/ \text{s}$ at first iteration in pipe listed in table \ref{tab:pipe_stability_test} and 9,753 chosen for $\Delta t$ . Plot for all tests is made at approximately t = 97,5 seconds.}
\label{fig:stability_theta_test_05_065_1}
\end{figure}

Due to the choice of simplifying, any natural dampening effect has thereby been disregarded, but as seen in figure \ref{fig:stability_theta_test_05_065_1} artificial dampening due to numerical errors can be reintroduced. By choosing a proper value of $\theta$ the simplification can be somewhat rectified, but at the same time, it can mitigate oscillations, which would be bound to happen when pipes of different diameters, slopes and $\Delta x$ are adjoined. As a consequence of introducing numerical dampening, waves of low amplitude will be dampened out. But due to the lengths sewer pipes typically are it is assumed to be an insignificant consequence compared to the reduction in oscillation which can be obtained. According to \cite{cunge1980practical} a value of approximately 0.65 is a reasonable choice for $\theta$, and for that reason, it will be used for the remaining part of the project. For comparison the test in figure \ref{fig:stability_test_theta_0_5} is replicated with the chosen value of $\theta$ and can be seen in figure \ref{fig:stability_test_theta_0_65}.

\begin{figure}[H]
 \centering
 \input{report/simulation/tikz/stability_test_theta_0_65}
\caption{Step in inflow given from 0,35 $\text{m}^\text{3}/ \text{s}$ to 0.7 $\text{m}^\text{3}/ \text{s}$ at first iteration in pipe listed in table \ref{tab:pipe_stability_test}. Plot for all tests is made at approximately t = 100 seconds.}
\label{fig:stability_test_theta_0_65}
\end{figure}

The chosen value of $\theta$ together with Courant's number as a tuning parameter could be a simple way to obtain values of $\Delta t$ and $\Delta x$ for which the simulated results are less affected by distortion caused by numerical errors. To be able to conclude on this as a feasible tuning parameter, further testing would be needed with different pipes with different specifications. Furthermore different steps in both directions of inflow at different initial heights would also be needed to conclude on the uniformity of the Courant number. 
%Due to the results shown in figure \ref{fig:stability_test_theta_0_65} and time constraints further investigations is not made into the subject.   

%\cite{szymkiewicz2010numerical}