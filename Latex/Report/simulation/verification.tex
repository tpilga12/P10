\section{Implementation \& Verification}\label{sec:implementation_and_verfication}

In this section the suggested structure in section \ref{sec:Structure}, implemented with the numerical solutions in section \ref{se:preissmann_scheme}-\ref{sec:concentrate}, is tested and verified.

The first part to be elaborated upon is the initialization.

 \subsection*{Initialization}

For the setup procedure of the simulation in list form, the specifications part shown in figure \ref{fig:sys_setup} needs to be defined. The parameters in the list for both pipe and tank can be seen in table \ref {tab:init_list}. 

\begin{enumerate} \label{tab:init_list}
	\item Pipe
	\begin{itemize}
		\item Length [m]
		\item Sections (Number of sections the pipe should be split in to)
		\item $\text{I}_\text{b}$ (Slope) [\textperthousand]
		\item $\Delta$x = Length/Sections [m]
		\item Diameter [meter]
		\item Theta (parameter used in Preissmann scheme)
		\item $\text{Q}_{\text{f}}$ (maximum flow found by Manning formula, see equation \ref{eq:qf_for_flow}) [$\text{m}^\text{3}/\text{s}$]
		\item Side/lateral inflow present 
		\item Section location in data 
	\end{itemize}
	\item Tank
	\begin{itemize}
		\item Size [$\text{m}^\text{3}$]
		\item Height [m]
		\item Area = Size / Height [$\text{m}^\text{2}$]
		\item Maximum outflow [$\text{m}^\text{3}/\text{s}$]
		\item Section location in data 
	\end{itemize}
	%b\caption{Table of needed parameters for pipe and tank}
\end{enumerate}

Some parameters can be found from others and is set to be calculated automatically. Furthermore an item is added that indicates in which section of the obtained simulation data the specific output of the component is located. This item is given the number of the order in which the component appears in the list. To give an overview of the system to be simulated, and to easily be able to locate specific parameters needed during simulation, three structures is returned to the workspace. These are named ``pipe\_spec'', ``tank\_spec'' and ``sys\_setup''. The first two structures holds the information shown in table \ref{tab:init_list} respectively. The last one, ``sys\_setup'', holds information of the various parts indexed in the order the system is setup and simulated. In figure \ref{fig:sys_setup_matlab} the content of ``sys\_setup'' is shown for a setup with two pipes and a tank.

\begin{figure}[H]
\centering
\includegraphics[width=0.5 \textwidth]{report/simulation/pictures/sys_setup_matlab.png}
\caption{Display of structure holding system setup information in MATLAB.}
\label{fig:sys_setup_matlab}
\end{figure}

An initialization scheme is constructed as per figure \ref{fig:simple_sewer} where adjoint pipes is considered as one part of the system and tank is used as a separator between parts.
The iterative scheme shown in figure \ref{fig:preissmann_grid_scheme_exampel} requires that boundary conditions is found before the iterative Preissmann scheme can be started. It has been decided by the project group that input should be given in flow, as input in height would be needed to be specific for the pipe inserted, to make the simulation universal. This means that from an initial input flow the corresponding height in the pipes needs to be found. By equation \ref{eq:calc_for_flowv2} flow can be obtained from height, but the equation is transcendental i.e. can not be solved analytically for height. This means that other means is necessary to obtain height from flow. This can be done in several ways, but the initial solution chosen is to use the MATLAB curve fitting toolbox.
For each pipe, during initialization, a data set from zero to the diameter of the pipe in thousand steps is created, and from which the corresponding flow is obtained by equation \ref{eq:calc_for_flowv2}.

\begin{figure}[H]
 \centering
 \input{report/simulation/tikz/curvefit_comparison}
\caption{Comparison between data curve fitted to a ninth order polynomial and raw data.}
\label{fig:curvefit_comparision}
\end{figure}
