\chapter{Discussion}\label{ch:discussion}
This chapter discuss the possible solution to some problems. Furthermore ideas to what could be done further is given. \fxnote{mangler en intro i diskution}
%Der burde laves noget til at simulere kemiske reaktioner
%	WATS model

As is it, for now, the simulation model is not able to simulate chemical reactions in the sewer. To be able to create an environment where the chemicals are reacting with each other one could look at the work shown in \cite{Sewer_processes}. Here a model called WATS is able to simulate the reaction in a sewer process. It can be used to simulated sewer process, where it is able to predict of which problems could arise. Therefore, it could be used to describe the condition in the tanks, to determined if the tank e.g. suffers from oxygen depletion and thereby give an indication on if an action should be done to mitigate the problem.   

Due to numerical problems, MPC would not be able to be implemented on the simulation model for Fredericia as the linearized model would have to high dimensions and because the linearized model consists of numerical small numbers. Therefore when predicting the future model in MPC problems arises, as these numerical small numbers will start to grow even smaller. However, if model order reduction could be implemented to lower the complexity of the large-scale system then there might be a possibility for to increase the prediction horizon and thereby allowing the MPC control to predict further into the future. 

As stability and precision are an important parameter to consider when simulating, therefore this Courant number needs further investment. As it highly variates with the average flow height, time step and distance step it is hard to find an optimal $\Delta t$ and $\Delta x$ when dealing with pipes of different lengths. However, if every pipe could be split up into the same section lengths a more optimal Courant number could be obtained. An even better solution would be to make variable time step for each pipe, thereby it would be able to obtain the desired Courant number, which would make the simulation less affect by distortion caused by numerical errors. 

\chapter{Conclusion}\label{ch:conclusion}

The focus of this project was to create a simulation model that was able to mimic the behavior of a real sewer system. Furthermore, MPC should be implemented to obtain an optimal control output into the WWTP based on the problem statement from section \ref{sec:problem_statement}. 

\begin{center}
\textit{How can a simulation environment be constructed, which mimic the behavior of a real sewer system, where MPC is utilized as the control scheme to obtain stable sewage output such that optimal performance can be obtained from a WWTP.}
\end{center}

A simulation model has been designed where it is possible to create a sewer system consisting of pipes, tanks and side inflow from different areas in a city, where it is able to simulate the wastewater flow and concentration throughout a city. Furthermore, it is constructed in a way, where it can be reconfigured to fit other cities by changing the order of pipe and tank to fit the desired city. The results showed that it is able to simulate a city, where different flow profiles are constructed for the residential and industrial areas and the larger industries. This showed that it was able to produce an output amount that was similar to the one given by Fredericia. However, the simulation model seems to variate in the output more than the data given by Fredericia. The reason is, that in the simulation setup a pump before the WWTP has not been accounted for, and therefore the flow into the WWTP is more smooth in the real case. Furthermore, the flow profiles from the residential and industrial areas have been connected directly onto the main sewer line in the simulation, and therefore are these not as attenuated as they would be in a real life scenario, which causes higher peaks in the results.      

An MPC controller was constructed to control the output of a tank in a sewer network in an optimal manner to limit the output variations. However, it was discovered, due to numerical problems in the linearized model, that it was not able to have a high prediction horizon as the quadratic problem became non-convex thereby having no solution to the problem. Therefore, the sewer system was reduced in size and a prediction horizon was found that was able to predict. Without constraints, the controller was able to keep a constant output, but at the cost of the tank was overfilled. Therefore constraints were introduced into the problem. However, this did not give the intended outcome. The controller started to produce an output that was not optimal, as it variated the output of the tank to a larger extent. Therefore, this controller needs further investigating in how to make it work properly with constraints.        

Though the project is not finalized, the simulation model is deemed as a plausible solution to simulate wastewater flow in urban environments and with more work into the MPC it can be used to analyze a real sewer network. Where it can be used to find the most optimal location to place tanks. Thereby reducing the variations in flow and concentration into the WWTP.  



